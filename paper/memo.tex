Context irrelevance means if we have seen the results of a computation before from a different context, we can reuse them.
%
The semantic counterpart to this idea is a memo table that we extend when popping and appeal to when about to push.
%
This simple idea works well with a deterministic semantics, but the non-determinism of abstraction requires care.
%
In particular, memo table entries can end up mapping to multiple results, but not all results will be found at the same time.
%
Note the memo table space:
\begin{align*}
  \mmemo \in \Memo &= \Context \finto \wp(\Relevant) \\
  \Relevant &::= \tpl{\mexpr,\maenv,\mstore,\mtime}
\end{align*}
%
There are a few ways to deal with multiple results:
\begin{enumerate}
\item{rerun the analysis with the last memo table until the table doesn't change (expensive),}
\item{short-circuit to the answer but also continue evaluating anyway (negates most benefit of short-circuiting), or}
\item{use a frontier-based semantics like in \autoref{sec:eng-frontier} with global $\mktab$ and $\mmemo$, taking care to
    \begin{enumerate}
    \item{at memo-use time, still extend $\mktab$ so later memo table extensions will ``flow'' to previous memo table uses, and}
    \item{when $\mktab$ and $\mmemo$ are extended at the same context at the same time, also create states that act like the $\mmemo$ extension point also returned to the new continuations stored in $\mktab$.}
    \end{enumerate}}
\end{enumerate}

We will only discuss the final approach.
%
The same result can be achieved with a one-state-at-a-time frontier semantics, but we believe this is cleaner and more parallelizable.
%
Its second subpoint we will call the ``push/pop rendezvous.''
%
The rendezvous is necessary because there may be no later push or pop steps that would regularly appeal to either (then extended) table at the same context.
%
The frontier-based semantics then makes sure these pushes and pops find each other to continue on evaluating.
%
In pushdown and nested word automata literature, the push to pop short-circuiting step is called a ``summary edge'' or with respect to the entire technique, ``summarization.''
%
We find the memoization analogy appeals to programmers' and semanticists' operational intuitions.
%

%
A second concern for using memo tables is soundness.
%
Without the completeness property of the semantics, memoized results in, \eg{}, an inexactly GC'd machine, can have dangling addresses since the possible stacks may have grown to include addresses that were previously garbage.
%
If the semantics does n\todo{}
%
Context-irrelevance is a property of the semantics \emph{without} continuation stores, so there is an additional invariant to that of \autoref{sec:pushdown} for the semantics with $\mktab$ and $\mmemo$: $\mmemo$ respects context irrelevance.
\begin{mathpar}
  \inferrule{\dom(\mmemo) \subseteq \dom(\mktab) \\
             \forall \mctx\equiv\tpl{\mexpr_c,\maenv_c,\mstore_c,\mtime_c} \in \dom(\mmemo),
                     \tpl{\mexpr_r,\maenv_r,\mstore_r,\mtime_r} \in \mmemo(\mctx), \\
                     \makont\in\mktab(\mctx),
                     \mkont\in\unroll{\mktab}{\makont}. \\
              \exists\mtrace\equiv\tpl{\mexpr_c,\maenv_c,\mkont},\mstore_c,\mtime_c \stepto_{\CESKt}^* \tpl{\mexpr_r,\maenv_r,\mkont},\mstore_r,\mtime_r. \hastail(\mtrace,\mkont)}
            {\inv_M(\mktab,\mmemo)}
\end{mathpar}
Inexact GC does \emph{not} respect context irrelevance for the same reasons it is not complete: some states are spurious, meaning some memo table entries will be spurious, and the expected path in the invariant will not exist.
%
The reason we use unrolled continuations instead of simply $\epsilon$ for this (balanced) path is precisely for stack inspection reasons.

\begin{equation*}
  {\mathcal F}_{\mexpr}(S,R,F,\mktab,\mmemo) = (S \cup F, R \cup R', F'\setminus S, \mktab', \mmemo')
\end{equation*}
where

\begin{tabular}{rlrlrl}
  $I$ &
  \multicolumn{5}{l}{
    \hspace{-3mm}$=\bigcup\limits_{s=(\mstate,\mstore,\mtime) \in
      F}{\setbuild{(\tpl{s,s'}, \mktab',\mmemo')}{s,\mktab,\mmemo
        \stepto s',\mktab',\mmemo'}}$}
\\
   $R'$ &\hspace{-3mm}$= \pi_0 I$ & $\mktab'$ & \hspace{-3mm}$= \bigsqcup\pi_1 I$ & $\mmemo'$ & \hspace{-3mm}$= \bigsqcup\pi_2 I$ \\
   $\Delta\mktab$ &\hspace{-3mm}$= \mktab'\setminus\mktab$ & $\Delta\mmemo$ & \hspace{-3mm}$= \mmemo'\setminus\mmemo$ & & \\
   $F'$ &
   \multicolumn{5}{l}{
     \hspace{-3mm}$= \pi_1 R' \cup \{{\tpl{\mexpr,\maenv,\makont},\mstore,\mtime} :
     {\mctx \in \dom(\Delta\mktab)\cap\dom(\Delta\mmemo).}$}
   \\ &\multicolumn{5}{l}{\hspace{-3mm}$\phantom{= \pi_1 R' \cup \{} \makont \in \Delta\mktab(\mctx),
       \tpl{\mexpr,\maenv,\mstore,\mtime} \in \Delta\mmemo(\mctx)\}$}
 \end{tabular}

 \begin{figure}
   \begin{center}
     $\mastate,\mstore,\mtime,\mktab,\mmemo \stepto
     \mastate',\mstore',\mtime',\mktab',\mmemo'$
     \begin{tabular}{r|l}
       \hline\vspace{-3mm}\\
       $\tpl{\sapp{\mexpri0}{\mexpri1},\maenv,\makont}$
       &
       $\tpl{\mexpri0,\maenv,\kcons{\appl{\mexpri1,\maenv}}{\mctx}}$ if $\mctx \notin\dom(\mmemo)$ \\
       & or \\
       &
       $\tpl{\mexpr',\maenv',\makont}$ if $\tpl{\mexpr',\maenv',\mstore',\mtime'} \in \mmemo(\mctx)$ \\
       where & $\mctx = \tpl{\sapp{\mexpri}{\mexpri1},\maenv,\mstore,\mtime}$ \\
       & $\mktab' = \joinm{\mktab}{\mctx}{\makont}$
       \\
       $\tpl{\mval,\maenv,\kcons{\appr{\slam{\mvar}{\mexpr},\maenv'}}{\mctx}}$
       &
       $\tpl{\mexpr,\maenv'',\makont}$ if $\makont \in \mktab(\mctx)$ \\
       where & $\maenv'' = \maenv'[\mvar\mapsto\maddr]$ \\
       & $\mstore' = \joinm{\mstore}{\maddr}{(\mval,\maenv)}$ \\
       & $\mmemo' = \joinm{\mmemo}{\mctx}{\tpl{\mexpr,\maenv'',\mstore',\mtime'}}$
     \end{tabular}
   \end{center}
   Where $\mtime' = \tick(\mastate,\mstore,\mtime)$, $\mstore' = \mstore$, $\mktab' =\mktab$ and $\mmemo' = \mmemo$ unless otherwise stated.
   \caption{Important memoization rules}
   \label{fig:memo}
 \end{figure}

The rules in \autoref{fig:memo} are the importantly changed rules from \autoref{sec:pushdown} that short-circuit to memoized results.
%
The technique looks more like memoization with a $\CESIKKstart$ machine, since the memoization points are truly at function call and return boundaries.
%
The $\pop$ function would need to also update $\mmemo$ if it dereferences through a context, but otherwise the semantics are updated \emph{mutatis mutandis}.

\begin{theorem}[Correctness]
Same property is the same as in \autoref{thm:global-pushdown}, where $\reify$ ignores the $\mktab$ component.
\end{theorem}
The proof appeals to the invariant on $\mmemo$ whose proof involves an additional argument for the short-circuiting step that reconstructs the path from a memoized result using both context irrelevance and the table invariants.